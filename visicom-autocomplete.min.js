let visicomAutoComplete=function(e){let l={selector:"#visicom-autocomplete",apiUrl:"https://api.visicom.ua/data-api/5.0/{lang}/",proxyApiGeocodeUrl:"",proxyApiFeatureUrl:"",apiKey:"",placeholder:"Search...",minChars:3,delay:150,width:"100%",height:null,map:null,marker:null,suggestsLimit:5,maxCharsInSuggest:55,lang:"local",searchTextPrefix:"",intersect:"",contains:"",includeCategories:[],excludeCategories:[],customFeatures:[],onSuggestSelected:function(e){console.log("Suggest selected: "+e.html)},displayDivSelector:null};"function"!=typeof Object.assign&&(Object.assign=function(e,t){"use strict";if(null===e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!==o)for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(n[l]=o[l])}return n}),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||window;for(var n=0;n<this.length;n++)e.call(t,this[n],n,this)}),l=Object.assign({},l,e);let t=f(l.selector);if(!t)return void console.log("Couldn't find element with "+l.selector+" selector.");let n=t.innerHTML.trim(),r,o,a;switch(l.lang){case"en":a="Nothing found, try to change keywords",poweredElementText="";break;case"ru":a="К сожалению, ничего не найдено, попробуйте изменить строку поиска",poweredElementText="";break;default:a="На жаль, нічого не знайдено, спробуйте змінити запит",poweredElementText=""}t.classList.add("visicom-autocomplete"),t.style.width=l.width,t.style.height=l.height;let i=document.createElement("input");i.placeholder=l.placeholder,i.setAttribute("autocomplete","off"),i.setAttribute("autocorrect","off"),i.setAttribute("autocapitalize","off"),i.setAttribute("spellcheck","false");let s=document.createElement("ul");s.classList.add("visicom-suggests");let c=document.createElement("button");if(c.classList.add("close"),c.style.width=l.height,c.style.height=l.height,t.appendChild(i),t.appendChild(s),t.appendChild(c),!n||n.indexOf('href="https://api.visicom.ua/"')<0)return void console.log("Visicom link not available.");if(t.removeChild(t.firstElementChild),!l.apiKey&&!l.proxyApiGeocodeUrl&&!l.proxyApiFeatureUrl)return void console.log("You didn't specify your API key.");let u=[],d=-1,p=null,m="";function f(e){return document.querySelector(e)}function g(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)}function h(){u=[],d=-1,c.classList.remove("visible"),s.classList.remove("open"),i.value="",l.displayDivSelector&&document.querySelector(l.displayDivSelector)&&(document.querySelector(l.displayDivSelector).innerHTML=""),s.contains(r)&&s.removeChild(r),s.contains(o)&&s.removeChild(o),l.map&&l.marker&&l.map.removeLayer(l.marker)}function y(){u=u.slice(0,l.suggestsLimit);let t=s.innerHTML="";u.forEach(function(e){t+="<li",e.feature&&e.feature.properties&&e.feature.properties.categories&&(t+=' class="'+e.feature.properties.categories.substring(0,e.feature.properties.categories.indexOf("_"))+'"'),t+=">",t+=e.html,t+="</li>"}),t?s.innerHTML=t:(r=document.createElement("li"),r.innerHTML=a,r.classList.add("not-found"),s.appendChild(r)),poweredElement=document.createElement("li"),poweredElement.innerHTML=poweredElementText,poweredElement.classList.add("powered-by"),s.appendChild(poweredElement),s.classList.add("open")}function v(e){i.value=u[e].html.replace("<strong>","").replace("</strong>",""),i.focus(),setTimeout(function(){s.classList.remove("open"),l.onSuggestSelected(u[e]),l.map&&function(e){l.marker&&l.map.removeLayer(l.marker);void 0!==e.feature.coords?(l.map.setView(e.feature.coords,19),l.marker&&(l.marker.setLatLng(e.feature.coords),l.map.addLayer(l.marker))):function(e){return e=l.proxyApiFeatureUrl?l.proxyApiFeatureUrl+"?feature_id="+e+"&lang="+l.lang+"&key="+l.apiKey:l.apiUrl.replace("{lang}",l.lang)+"/feature/"+e+".json?key="+l.apiKey,fetch(encodeURI(e)).then(function(e){return e.json()})}(e.feature.id).then(function(e){"Point"===e.geometry.type?(l.map.setView([e.geometry.coordinates[1],e.geometry.coordinates[0]],19),l.marker&&(l.marker.setLatLng([e.geometry.coordinates[1],e.geometry.coordinates[0]]),l.map.addLayer(l.marker))):e.properties.categories.includes("adr_address")?(l.map.setView([e.geo_centroid.coordinates[1],e.geo_centroid.coordinates[0]],19),l.marker&&(l.marker.setLatLng([e.geo_centroid.coordinates[1],e.geo_centroid.coordinates[0]]),l.map.addLayer(l.marker))):l.map.fitBounds(function(e){e=e.bbox||(e.geometry||{}).bbox;if(e)return[[e[1],e[0]],[e[3],e[2]]];return{}}(e),{animate:!0,maxZoom:17})}).catch(function(e){console.log("Error in API request: "+e),h()})}(u[e])},0)}function x(e,t){return 0===e.indexOf(t)}function w(e,t,n){return n?e.length>=l.maxCharsInSuggest?k(e.substring(0,l.maxCharsInSuggest).concat("..."),t):k(e,t):e}function k(e,t){let n=e.toLowerCase();var r=t.toLowerCase();return n.indexOf(r)<0?e:e.substring(0,n.indexOf(r))+"<strong>"+e.substring(n.indexOf(r),n.indexOf(r)+t.length)+"</strong>"+e.substring(n.indexOf(r)+t.length)}function C(e){return e.filter(function(e){return e})}l.map&&!l.marker&&("undefined"==typeof L||null===L?console.log("Leaflet object is not available. Cannot create marker object."):(l.marker=L.marker([],{icon:L.divIcon({html:"<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'><defs><filter id='blur1' x='-100%' y='-100%' width='400%' height='400%'><feGaussianBlur stdDeviation='2'></feGaussianBlur></filter></defs><style>.selected-bg {fill: #808080;filter: url(#blur1);}.selected-fill {fill: #ffffff;stroke: #ff0000;stroke-width: 1.7px;}</style><g><circle class='selected-bg' cx='12' cy='12' r='9'/><circle class='selected-fill' cx='11' cy='11' r='9' /><path fill='#ff0000' d='m11 5.7c-2.1285 0-3.85 1.7215-3.85 3.85 0 2.8875 3.85 7.15 3.85 7.15s3.85-4.2625 3.85-7.15c0-2.1285-1.7215-3.85-3.85-3.85zm0 5.225c-0.759 0-1.375-0.616-1.375-1.375s0.616-1.375 1.375-1.375 1.375 0.616 1.375 1.375-0.616 1.375-1.375 1.375z'/></g></svg>",iconSize:[24,24]}),draggable:!0}),L.DomEvent.disableClickPropagation(t))),g(i,"input",function(){d=-1,clearTimeout(p),p=null,p=setTimeout(function(){if(m=i.value,0<m.length){if(c.classList.add("visible"),!(m.length<l.minChars)){u=[];let t=[];if(s.classList.remove("open"),l.customFeatures.forEach(function(e){e.keywords.toLowerCase().includes(m.toLocaleLowerCase())&&u.push({html:w(e.html,m,!0),feature:{coords:e.coords}})}),t=b.search(m),t.length)return t.forEach(function(e){e={html:b.format(e),feature:{coords:e}};u.push(e)}),void y();t=[],function(e){let t=l.includeCategories.join(",");t=t?"&categories="+t:"";let n=l.excludeCategories.join(",");n=n?"&categories_exclude="+n:"";let r=l.intersect;r=r?"&intersect="+r:"";let o=l.contains;o=o?"&contains="+o:"";e=l.proxyApiGeocodeUrl?l.proxyApiGeocodeUrl+"?text="+l.searchTextPrefix+e+"&lang="+l.lang+t+n+r+o+"&key="+l.apiKey+"&limit="+l.suggestsLimit:l.apiUrl.replace("{lang}",l.lang)+"/geocode.json?text="+l.searchTextPrefix+e+t+n+r+o+"&key="+l.apiKey+"&limit="+l.suggestsLimit;return fetch(encodeURI(e)).then(function(e){return e.json()})}(m).then(function(e){"FeatureCollection"===e.type?t=e.features:"Feature"===e.type&&t.push(e),t.forEach(function(e){(e.properties.name||e.properties.vitrine)&&u.push({html:function(e,t,n){let r=e.properties,o=r.categories,l=null;x(o,"adm_country")?l=C([r.name]).join(""):x(o,"adm_district")?l=C([r.name," ",r.type," ",a(r.settlement_type,r.settlement)]).join(""):x(o,"adm_level1")?l=C([r.name,", ",r.country]).join(""):x(o,"adm_level2")?l=C([r.name,", ",r.country,", ",r.level1]).join(""):x(o,"adm_level3")?l=C([r.name,", ",r.level1,", ",r.level2]).join(""):x(o,"adm_settlement")?l=C([a(r.type,r.name)," ",r.level1," ",r.level2," ",r.level3]).join(""):x(o,"adr_street")?l=C([r.type," ",r.name,", ",a(r.settlement_type,r.settlement)," ",r.zone]).join(""):x(o,"adr_address")?l=C([r.settlement,", ",r.street_type," ",r.street,", ",r.name]).join(""):x(o,"poi")&&(l=C([r.vitrine," ",r.address]).join(""));return l?w(l,t,n):w(r.name,t,n);function a(e,t){return e?t+" "+e:t}}(e,m,!1),feature:e})}),y()}).catch(function(e){console.log("Error in API request: "+e),h()})}}else h()},l.delay)}),g(document,"keydown",function(e){27===e.keyCode&&(h(),i.blur())}),g(s,"click",function(e){0!==u.length&&((e=Array.prototype.indexOf.call(e.target.parentNode.children,e.target))>=u.length||(s.childNodes.forEach(function(e){e.classList.remove("selected")}),d=e,s.childNodes[d].classList.add("selected"),v(e)))}),g(i,"keydown",function(t){if(13===t.keyCode)0<u.length&&v(0<d?d:0);else if((38===t.keyCode||40===t.keyCode)&&(t.preventDefault(),0!==u.length)){let e=!1;s.classList.contains("open")||(s.classList.add("open"),e=!0),s.childNodes.forEach(function(e){e.classList.remove("selected")}),38!==t.keyCode||e?e||(d=d===u.length-1?-1:d+1):d=d<0?u.length-1:d-1,0<=d?(i.value=u[d].html.replace("<strong>","").replace("</strong>",""),s.childNodes[d].classList.add("selected")):(i.value=m,i.setSelectionRange(m.length,m.length))}}),g(i,"focus",function(e){(0<u.length&&!s.classList.contains("open")||s.contains(r))&&s.classList.add("open"),e.stopPropagation()}),g(i,"click",function(e){(0<u.length&&!s.classList.contains("open")||s.contains(r))&&s.classList.add("open"),e.stopPropagation()}),g(c,"click",function(){h(),i.focus()}),g(f("body"),"click",function(t){t.target!==s&&t.target!==i&&t.target!==c&&(!s.hasChildNodes()||s.hasChildNodes()&&[].slice.call(s.childNodes).every(function(e){return t.target!==e}))&&s.classList.remove("open")}),l.map&&l.map.on("click",function(){s.classList.remove("open"),i.blur()});let b={search:function(e){if(0===e.length||e.trim().length<4)return[];var t=b.parse(e);if(null===t)return[];let n=[[t.lat,t.lng]];return-1!==e.search(/[NSEW]/)||n.push([t.lng,t.lat]),n},format:function(e){function t(e){let t={};return t.hemisphere=0<=e?1:-1,e=Math.abs(e),t.degrees=Math.floor(e),t.degreesDecimal=Math.min(9999,Math.round(1e4*(e-t.degrees))),e=60*e%60,t.minutes=Math.floor(e),t.minutesDecimal=Math.min(999,Math.round(1e3*(e-t.minutes))),e=60*e%60,t.seconds=Math.floor(e),t.secondsDecimal=Math.min(9,Math.floor(10*(e-t.seconds))),t}var n="DDD°MM′SS″H",r=t(e[0]),e=t(e[1]);return""+(r=n.replace("H",1===r.hemisphere?"N":"S").replace("DDD",r.degrees).replace("MM",r.minutes).replace("SS",r.seconds))+(e=n.replace("H",1===e.hemisphere?"E":"W").replace("DDD",e.degrees).replace("MM",e.minutes).replace("SS",e.seconds))}};return b.parse=function(e){function t(t,n){t=(t=t.toUpperCase()).match(/[NEWS]/g);if(1===t.length)return"N"===t[0]?{lat:n[0],lng:n[1]}:"E"===t[0]?{lng:n[0],lat:n[1]}:"S"===t[0]?{lat:-n[0],lng:n[1]}:"W"===t[0]?{lng:-n[0],lat:n[1]}:void 0;if(2===t.length){let e={};return"E"===t[0]?e.lng=n[0]:"W"===t[0]?e.lng=-n[0]:"N"===t[0]?e.lat=n[0]:"S"===t[0]&&(e.lat=-n[0]),"E"===t[1]?e.lng=n[1]:"W"===t[1]?e.lng=-n[1]:"N"===t[1]?e.lat=n[1]:"S"===t[1]&&(e.lat=-n[1]),e}}let n=e.match(/\d/g);if(null===n)return null;var r=null===n?0:n.length;if(n=e.match(/\D/g),1.5*r<=(null===n?0:n.length))return null;if(e=(e=e.replace(/,/gim,".")).replace(/([+-])\s(\d+)/gim,"$1$2"),n=e.match(/[+-]?\d+[.,]?(?:\d+)?/gim),null===n)return null;if(6!==n.length&&4!==n.length)return 2===n.length?null!==/[news]/gi.exec(e)?t(e,[parseFloat(n[0]),parseFloat(n[1])]):{lat:parseFloat(n[0]),lng:parseFloat(n[1])}:null;r=function(e){var t=/^[+-]/;let n="",r="",o=0,l=0;return 6===e.length?(null!==e[0].match(t)?(n=e[0].match(t),e[0]=e[0].replace(t,"")):n="+",null!==e[3].match(t)?(r=e[3].match(t),e[3]=e[3].replace(t,"")):r="+",o=parseFloat(e[0])+1/60*parseFloat(e[1])+1/3600*parseFloat(e[2]),l=parseFloat(e[3])+1/60*parseFloat(e[4])+1/3600*parseFloat(e[5]),[parseFloat(n+o),parseFloat(r+l)]):4===e.length?(null!==e[0].match(t)?(n=e[0].match(t),e[0]=e[0].replace(t,"")):n="+",null!==e[2].match(t)?(r=e[2].match(t),e[2]=e[2].replace(t,"")):r="+",o=parseFloat(e[0])+1/60*parseFloat(e[1]),l=parseFloat(e[2])+1/60*parseFloat(e[3]),[parseFloat(n+o),parseFloat(r+l)]):null}(n);return null!==/[news]/gi.exec(e)?t(e,r):{lat:parseFloat(r[0]),lng:parseFloat(r[1])}},{clear:h}};"function"==typeof define&&define.amd?define("visicomAutoComplete",function(){return visicomAutoComplete}):"undefined"!=typeof module&&module.exports?module.exports=visicomAutoComplete:window.visicomAutoComplete=visicomAutoComplete;